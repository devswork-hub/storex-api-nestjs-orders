# https://medium.com/norsys-octogone/a-local-environment-for-mongodb-with-docker-compose-ba52445b93ed
services:
  # rabbitmq:
  #   image: rabbitmq:3-management
  #   container_name: rabbitmq
  #   restart: unless-stopped
  #   ports:
  #     - '5672:5672'
  #     - '15672:15672'
  #   environment:
  #     RABBITMQ_DEFAULT_USER: admin
  #     RABBITMQ_DEFAULT_PASS: admin
  redis:
    networks:
      - app
    container_name: cache
    image: redis
    ports:
      - 6379:6379
    volumes:
      - redis:/data
  # tmp-keycloak:
  #   image: quay.io/keycloak/keycloak:24.0.0
  #   restart: always
  #   container_name: storex_keycloak
  #   environment:
  #     KEYCLOAK_USER: ${KEYCLOAK_USER}
  #     KEYCLOAK_PASSWORD: ${KEYCLOAK_PASS}
  #     DB_VENDOR: h2
  #     KEYCLOAK_ADMIN: ${KEYCLOAK_USER}
  #     KEYCLOAK_ADMIN_PASSWORD: ${KEYCLOAK_PASS}
  #   ports:
  #     - '8080:8080'
  #   env_file:
  #     - .env
  mongodb:
    image: mongo:latest
    restart: always
    container_name: storex_mongodb_orders
    environment:
      MONGO_INITDB_ROOT_USERNAME: ${MONGODB_USER}
      MONGO_INITDB_ROOT_PASSWORD: ${MONGODB_PASS}
    ports:
      - '27017:27017'
    env_file:
      - .env
    networks:
      - app

  nestjs-c:
    build: .
    env_file:
      - .env
    ports:
      - '3000:3000'
    depends_on:
      - redis
      - mongodb
    networks:
      - app

volumes:
  redis:
    driver: local

networks:
  app:
    driver: bridge
